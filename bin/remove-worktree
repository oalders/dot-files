#!/usr/bin/env bash

set -x

if [[ $# -eq "0" || $# -gt "2" ]]; then
    echo "Usage: remove-worktree [-f] branch-name"
    exit
fi

BRANCH_NAME=$1
STRIP="oalders/"

shift
echo "$BRANCH_NAME"

# If we can't kill the tmux session, then that's ok. It may just not exist.
if [[ -n $(pgrep tmux) ]]; then
    # tmux session name will contain the git branch name
    session=$(tmux list-session | grep oalders/update-schedule | awk -v FS=':' '{print $1}')
    tmux kill-session -t "$session"
fi

# exit() on failures from this point forward
set -e

# We need to be inside the repository in order to remove the worktree.
GIT_DIR=$(git rev-parse --git-common-dir)
cd "$GIT_DIR/.." || exit 1

git worktree remove "$@" "$BRANCH_NAME"
git branch -D "$@" "$BRANCH_NAME"
